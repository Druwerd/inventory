#!/usr/bin/env ruby

require 'rubygems'
require 'rest_client'
require 'json'
require 'facter'
Facter.loadfacts

SERVER_URL = "http://localhost:3000"

hostname = `hostname`.strip
facts = Facter.to_hash.merge({:name => hostname})
facts.delete("id") # id must be set by mongo mapper not Facter

begin
  print "Adding #{hostname}..."
  response = RestClient.post "#{SERVER_URL}/servers.json", :server => facts, :content_type => 'application/json', :accept => :json
  puts "done"
rescue Exception => e
  puts "error"
  puts e
  exit 1
end
